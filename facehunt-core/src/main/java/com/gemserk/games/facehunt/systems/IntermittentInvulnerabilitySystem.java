package com.gemserk.games.facehunt.systems;

import com.artemis.Entity;
import com.artemis.EntityProcessingSystem;
import com.gemserk.games.facehunt.components.HealthComponent;
import com.gemserk.games.facehunt.components.IntermittentInvulnerabilityComponent;

public class IntermittentInvulnerabilitySystem extends EntityProcessingSystem {

	public IntermittentInvulnerabilitySystem() {
		super(IntermittentInvulnerabilityComponent.class);
	}

	@Override
	protected void process(Entity e) {
		IntermittentInvulnerabilityComponent invulnerabilityComponent = e.getComponent(IntermittentInvulnerabilityComponent.class);

		invulnerabilityComponent.setCurrentTime(invulnerabilityComponent.getCurrentTime() - world.getDelta());

		if (invulnerabilityComponent.getCurrentTime() > 0)
			return;
		
		invulnerabilityComponent.setCurrentTime(invulnerabilityComponent.getTime());
		
		HealthComponent healthComponent = e.getComponent(HealthComponent.class);
		
		invulnerabilityComponent.toggle();
		
		if (invulnerabilityComponent.isEnabled()) {
			invulnerabilityComponent.setPreviousResistance(healthComponent.getResistance());
			healthComponent.setResistance(1f);
			invulnerabilityComponent.getOnEnabledTrigger().trigger(e);
		} else {
			healthComponent.setResistance(invulnerabilityComponent.getPreviousResistance());
			invulnerabilityComponent.getOnDisabledTrigger().trigger(e);
		}

	}

}
